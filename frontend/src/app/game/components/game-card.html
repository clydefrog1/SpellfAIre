<div
  class="game-card"
  [class]="cardClass()"
  [class.playable]="playable()"
  [class.selected]="selected()"
  [class.insufficient-mana]="insufficientMana()"
  [class.spell]="isSpell()"
  [class.compact]="compact()"
  [class.large]="large()"
  [class.hide-cost]="hideCost()"
  (click)="onClick()"
  [attr.role]="interactive() ? 'button' : 'presentation'"
  [attr.tabindex]="interactive() && playable() ? 0 : -1"
  [attr.aria-label]="interactive() ? (card().name + (hideCost() ? '' : (' - Cost ' + card().cost))) : null"
>
  <!-- Mana Cost -->
  @if (!hideCost()) {
    <div class="card-cost">{{ card().cost }}</div>
  }

  <!-- Insufficient mana tooltip -->
  @if (insufficientMana()) {
    <div class="not-enough-mana-tip" role="tooltip">
      Not enough mana
    </div>
  }

  <!-- Playable action hint -->
  @if (playable()) {
    <div class="playable-action-tip" role="tooltip">{{ playableTip() }}</div>
  }

  <!-- Nameplate -->
  <div class="card-nameplate">
    <div class="card-name">{{ card().name }}</div>
  </div>

  <ng-template #keywordSlots>
    @for (kw of displayKeywords(); track kw) {
      <span
        class="card-slot"
        [attr.title]="keywordTitle(kw)"
        [attr.aria-label]="kw"
        aria-hidden="true"
      >
        @switch (kw) {
          @case ('GUARD') {
            <!-- Shield -->
            <svg width="12" height="12" viewBox="0 0 12 12" display="block" aria-hidden="true">
              <path d="M6 1l4 2v3.5C10 9.1 8.3 11 6 11 3.7 11 2 9.1 2 6.5V3l4-2z" fill="currentColor" />
              <path d="M6 2.2 3 3.6v2.9c0 1.9 1.2 3.3 3 3.7 1.8-.4 3-1.8 3-3.7V3.6L6 2.2z" fill="currentColor" opacity=".35" />
            </svg>
          }
          @case ('CHARGE') {
            <!-- Bolt -->
            <svg width="12" height="12" viewBox="0 0 12 12" display="block" aria-hidden="true">
              <path d="M6.6 1 2 7h3.2L4.7 11 10 4H6.8V1z" fill="currentColor" />
            </svg>
          }
          @case ('WARD') {
            <!-- Ward -->
            <svg width="12" height="12" viewBox="0 0 12 12" display="block" aria-hidden="true">
              <path d="M6 1l4 2v3.5C10 9.1 8.3 11 6 11 3.7 11 2 9.1 2 6.5V3l4-2z" fill="currentColor" />
              <path d="M6 3.1l1.1 1.5L6 8.7 4.9 4.6 6 3.1z" fill="rgba(13,18,19,.55)" />
            </svg>
          }
          @case ('LIFESTEAL') {
            <!-- Lifesteal (drop) -->
            <svg width="12" height="12" viewBox="0 0 12 12" display="block" aria-hidden="true">
              <path d="M6 1s3 3.2 3 5.5S7.7 11 6 11 3 8.8 3 6.5 6 1 6 1z" fill="currentColor" />
              <path d="M5.2 8.4c.3.4.7.6 1.2.6.6 0 1.1-.4 1.3-1" stroke="rgba(13,18,19,.55)" stroke-width=".6" fill="none" stroke-linecap="round" />
            </svg>
          }
        }
      </span>
    }
  </ng-template>

  <!-- Main (Art + Stats) -->
  <div class="card-main">
    <div class="card-art" aria-hidden="true">
      <div class="card-art-inner">
        <div class="card-monogram">{{ monogram() }}</div>
      </div>
    </div>

    @if (compact()) {
      <div class="card-main-right">
        <div class="card-stats" aria-label="Stats">
          @if (displayAttack() !== null) {
            <div class="stat-row">
              <span class="stat-value">{{ displayAttack() }}</span>
              <span class="stat-icon" aria-hidden="true">⚔️</span>
              <span class="stat-label">ATK</span>
            </div>
          }

          @if (displayHealth() !== null) {
            <div class="stat-row">
              <span class="stat-value">{{ displayHealth() }}</span>
              <span class="stat-icon" aria-hidden="true">❤️</span>
              <span class="stat-label">HP</span>
            </div>
          }
        </div>

        <div class="card-slots" aria-label="Keywords">
          <ng-container *ngTemplateOutlet="keywordSlots" />
        </div>
      </div>
    } @else {
      <div class="card-stats" aria-label="Stats">
        @if (displayAttack() !== null) {
          <div class="stat-row">
            <span class="stat-value">{{ displayAttack() }}</span>
            <span class="stat-icon" aria-hidden="true">⚔️</span>
            <span class="stat-label">ATK</span>
          </div>
        }

        @if (displayHealth() !== null) {
          <div class="stat-row">
            <span class="stat-value">{{ displayHealth() }}</span>
            <span class="stat-icon" aria-hidden="true">❤️</span>
            <span class="stat-label">HP</span>
          </div>
        }
      </div>
    }
  </div>

  @if (!compact()) {
    <!-- Keyword slots (icons only) -->
    <div class="card-slots" aria-label="Keywords">
      <ng-container *ngTemplateOutlet="keywordSlots" />
    </div>
  }

  <!-- Rules Text (always present for consistent layout) -->
  <div class="card-rules" [class.empty]="!card().rulesText">{{ card().rulesText ?? '' }}</div>

  <!-- Flavor text (always present for consistent layout) -->
  @if (!compact()) {
    <div class="card-fluff" [class.empty]="!card().flavorText">{{ card().flavorText ?? '' }}</div>
  }

  <!-- Type indicator -->
  @if (!compact()) {
    <div class="card-type">{{ isCreature() ? 'CREATURE' : 'SPELL' }}</div>
  }
</div>
